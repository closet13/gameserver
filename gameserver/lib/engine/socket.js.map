{"version":3,"sources":["../../src/engine/socket.js"],"names":[],"mappings":";;;;;;AAIA,IAAI,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;;AAE/B,MAAM,CAAC,OAAO,CAAC,OAAO,GAAG,UAAC,UAAU,EAAI;AACpC,QAAI,EAAE,GAAG,UAAU,CAAC,GAAG,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;;AAEnE,cAAU,CAAC,GAAG,CAAC,EAAE,CAAC,YAAY,EAAE,UAAU,MAAM,EAAE;AAC9C,eAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;;AAEhC,cAAM,CAAC,EAAE,CAAC,OAAO,EAAE,UAAC,IAAI,EAAI;AACxB,gBAAI,IAAI,CAAC,UAAU,EAAE;;AAEjB,sBAAM,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,cAAc,GAAG,UAAU,CAAC,OAAO,CAAC,wBAAwB,EACvF,EAAC,KAAK,EAAE,IAAI,CAAC,KAAK,EAAC,EACnB,UAAC,GAAG,EAAE,IAAI,EAAE,IAAI,EAAI;AAChB,wBAAI,GAAG,EACH,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,KAC5B;;AAED,kCAAU,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,EAAC,KAAK,EAAE,IAAI,CAAC,QAAQ,EAAC,EAAC,EAAsB,CAAC,CACpE,IAAI,CAAC,UAAC,GAAG,EAAE,IAAI,EAAI;AAChB,kCAAM,CAAC,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;yBACnC,CAAC,CAAA;qBACT;iBACJ,CAAC,CAAC;aACV,MAAM,IAAI,IAAI,CAAC,QAAQ,EAAE,EAGzB;SACJ,CAAC,CAAC;KACN,CAAC,CAAC;AACH,cAAU,CAAC,GAAG,CAAC,GAAG,CAAC,UAAU,MAAM,EAAE,IAAI,EAAE;AACvC,eAAO,CAAC,GAAG,CAAC,6BAA6B,CAAC,CAAC;;AAE3C,YAAI,UAAU,CAAC,IAAI,EAAE;AACjB,gBAAI,EAAE,CAAC;AACP,kBAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;SACxB,MACI;AACD,gBAAI,CAAC,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAC,CAAC;SACxC;KACJ,CAAC,CAAA;CACL,CAAC","file":"src/engine/socket.js","sourcesContent":["/**\n * Created by santi8ago8 on 06/03/15.\n */\n\nvar needle = require('needle');\n\nmodule.exports.Sockets = (gameServer)=> {\n    var io = gameServer._io = require('socket.io')(gameServer._server);\n\n    gameServer._io.on('connection', function (socket) {\n        console.log('a user connected');\n\n        socket.on('login', (data)=> {\n            if (data.playerList) {\n                //go to login server.\n                needle.post(gameServer._config.loginServerUrl + gameServer._config.loginServerUrlCheckToken,\n                    {token: data.token},\n                    (err, resp, body)=> {\n                        if (err)\n                            gameServer.logger.error(err);\n                        else {\n                            //body.username\n                            gameServer._db.Player.find({owner: body.username},{/*TODO: projection*/})\n                                .exec((err, resp)=> {\n                                    socket.emit('playerList', resp);\n                                })\n                        }\n                    });\n            } else if (data.playerId) {\n                //find the player in the db.\n\n            }\n        });\n    });\n    gameServer._io.use(function (socket, next) {\n        console.log('a user connected middleware');\n        //TODO: check max players.\n        if (gameServer.open) {\n            next();\n            socket.emit('login');\n        }\n        else {\n            next(new Error('Game server close'));\n        }\n    })\n};"]}