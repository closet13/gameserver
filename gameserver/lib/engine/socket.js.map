{"version":3,"sources":["../../src/engine/socket.js"],"names":[],"mappings":";;;;;AAGA,IAAI,IAAI,QAAQ,QAAR,CAAJ;AACJ,IAAI,UAAU,EAAV;;AAEJ,OAAO,OAAP,CAAe,OAAf,GAAyB,UAAC,UAAD,EAAe;;AAEpC,QAAI,KAAK,WAAW,GAAX,GAAiB,QAAQ,WAAR,EAAqB,WAAW,OAAX,EAAoB;AAC/D,sBAAc,OAAO,EAAP,GAAY,EAAZ;AACd,qBAAa,OAAO,EAAP,GAAY,EAAZ;KAFS,CAAjB,CAF2B;;AAOpC,eAAW,GAAX,CAAe,EAAf,CAAkB,YAAlB,EAAgC,UAAU,MAAV,EAAkB;;AAE9C,mBAAW,aAAX,CAAyB,YAAzB,EAAuC,MAAvC,EAF8C;;AAI9C,eAAO,EAAP,CAAU,OAAV,EAAmB,UAAC,IAAD,EAAS;AACxB,oBAAQ,GAAR,CAAY,IAAZ,EADwB;AAExB,wBAAY,YAAK;AACb,wBAAQ,GAAR,CAAY,YAAZ,EADa;AAEb,uBAAO,IAAP,CAAY,YAAZ;;AAFa,sBAIb,CAAO,IAAP,CAAY,OAAZ,EAAqB,EAAC,kBAAgB,IAAhB,EAAtB,EAJa;aAAL,EAKT,IALH,EAFwB;SAAT,CAAnB,CAJ8C;;AAe9C,eAAO,EAAP,CAAU,GAAV,EAAe,UAAC,CAAD,EAAM;AACjB,uBAAW,aAAX,CAAyB,OAAO,EAAE,CAAF,EAAK,EAAE,CAAF,EAAK,OAAO,MAAP,CAA1C,CADiB;SAAN,CAAf,CAf8C;KAAlB,CAAhC,CAPoC;AA2BpC,eAAW,GAAX,CAAe,GAAf,CAAmB,UAAU,MAAV,EAAkB,IAAlB,EAAwB;AACvC,gBAAQ,GAAR,CAAY,6BAAZ;;AADuC,YAGnC,WAAW,IAAX,EAAiB;AACjB,mBADiB;AAEjB,mBAAO,IAAP,CAAY,OAAZ,EAFiB;SAArB,MAIK;AACD,iBAAK,IAAI,KAAJ,CAAU,mBAAV,CAAL,EADC;SAJL;KAHe,CAAnB,CA3BoC;CAAf","file":"socket.js","sourcesContent":["/**\r\n * Created by santi8ago8 on 06/03/15.\r\n */\r\nlet _ = require('lodash');\r\nlet pending = [];\r\n\r\nmodule.exports.Sockets = (gameServer)=> {\r\n\r\n    var io = gameServer._io = require('socket.io')(gameServer._server, {\r\n        pingInterval: 1000 * 60 * 60,\r\n        pingTimeout: 1000 * 60 * 60\r\n    });\r\n\r\n    gameServer._io.on('connection', function (socket) {\r\n\r\n        gameServer.triggerPlugin('connection', socket);\r\n\r\n        socket.on('hello', (name)=> {\r\n            console.log(name);\r\n            setInterval(()=> {\r\n                console.log(\"emit hello\");\r\n                socket.emit('helloempty');\r\n                //TODO. rem\r\n                socket.emit(\"hello\", {greet: `Hello ${name}`});\r\n            }, 1000);\r\n\r\n        });\r\n\r\n        socket.on(\"c\", (c)=> {\r\n            gameServer.triggerPlugin(\"s:\" + c.c, c.d, socket.player);\r\n        });\r\n\r\n    });\r\n    gameServer._io.use(function (socket, next) {\r\n        console.log('a user connected middleware');\r\n        //TODO: check max players.\r\n        if (gameServer.open) {\r\n            next();\r\n            socket.emit('login');\r\n        }\r\n        else {\r\n            next(new Error('Game server close'));\r\n        }\r\n    });\r\n\r\n};\r\n\r\n"]}