{"version":3,"sources":["../../src/plugins/mob.js"],"names":[],"mappings":"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","file":"mob.js","sourcesContent":["/**\n * Created by santi8ago8 on 15/11/15.\n */\n\nvar Plugin = require('./../plugin').Plugin;\nlet _ = require('lodash');\nlet uuid = require('node-uuid');\n\nclass Mob extends Plugin {\n    constructor() {\n        super();\n        this.coords = {\n            x: {from: -440.1, to: 556.01},\n            y: {from: 81, to: 82},\n            z: {from: -438.1, to: 557.01}\n        };\n        this.types = [\n            //{name: 'raptor', health: 24},\n            {name: 'slime', health: 16},\n            {name: 'wasp', health: 12}\n        ];\n    }\n\n    enabled(gs) {\n        this.gs = gs;\n        this.gs._mobs = [];\n        setInterval(this.createMob.bind(this), 400);\n        this.on('s:hitmob', this.hitMob.bind(this));\n        this.on('player:enter', this.playerEnter.bind(this));\n    }\n\n    createMob() {\n        if (this.gs._mobs.length < 45) {\n            let mob = _.clone(_.sample(this.types));\n            _.assign(mob, {\n                _id: uuid.v4(),\n                t: {\n                    p: {\n                        x: _.random(this.coords.x.from, this.coords.x.to),\n                        y: _.random(this.coords.y.from, this.coords.y.to),\n                        z: _.random(this.coords.z.from, this.coords.z.to)\n                    }\n                }\n            });\n            this.gs._mobs.push(mob);\n            this.gs._io.emit('mobcreate', mob);\n        }\n    }\n\n    playerEnter(player) {\n        _.forEach(this.gs._mobs, (m)=> {\n            player.socket.emit('mobcreate', m);\n        });\n\n    }\n\n    hitMob(data) {\n\n        let to = _.find(this.gs._mobs, {_id: data.to});\n        let from = _.find(this.gs._players, {_id: data.sender});\n        if (to && from) {\n            let multiply = 1;\n            if (data.skill) {\n                multiply = data.skill;\n            }\n            let damage = parseInt(_.random(2, 7 * multiply));\n            to.health -= damage;\n            data.health = to.health;\n            if (to.health <= 0) {\n                to.health = 0;\n                data.health = 0;\n            }\n            this.gs._io.emit('mobhit', data);\n            if (to.health <= 0) {\n                this.gs._io.emit('mobkill', to);\n                _.remove(this.gs._mobs, {_id: to._id});\n            }\n            from.data.health -= Math.floor(1 + Math.random() * 3);\n\n            this.gs.plugins.Player.syncHealth(from);\n        }\n    }\n}\n\nMob.version = 0.1;\n\nmodule.exports.Mob = Mob;"]}