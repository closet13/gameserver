{"version":3,"sources":["../../src/plugins/mob.js"],"names":[],"mappings":"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","file":"mob.js","sourcesContent":["/**\r\n * Created by santi8ago8 on 15/11/15.\r\n */\r\n\r\nvar Plugin = require('./../plugin').Plugin;\r\nlet _ = require('lodash');\r\nlet uuid = require('node-uuid');\r\n\r\nclass Mob extends Plugin {\r\n    constructor() {\r\n        super();\r\n        this.coords = {\r\n            x: {from: -440.1, to: 556.01},\r\n            y: {from: 81, to: 82},\r\n            z: {from: -438.1, to: 557.01}\r\n        };\r\n        this.types = [\r\n            //{name: 'raptor', health: 24},\r\n            {name: 'slime', health: 16},\r\n            {name: 'wasp', health: 12}\r\n        ];\r\n    }\r\n\r\n    enabled(gs) {\r\n        this.gs = gs;\r\n        this.gs._mobs = [];\r\n        setInterval(this.createMob.bind(this), 400);\r\n        this.on('s:hitmob', this.hitMob.bind(this));\r\n        this.on('player:enter', this.playerEnter.bind(this));\r\n    }\r\n\r\n    createMob() {\r\n        if (this.gs._mobs.length < 45) {\r\n            let mob = _.clone(_.sample(this.types));\r\n            _.assign(mob, {\r\n                _id: uuid.v4(),\r\n                t: {\r\n                    p: {\r\n                        x: _.random(this.coords.x.from, this.coords.x.to),\r\n                        y: _.random(this.coords.y.from, this.coords.y.to),\r\n                        z: _.random(this.coords.z.from, this.coords.z.to)\r\n                    }\r\n                }\r\n            });\r\n            this.gs._mobs.push(mob);\r\n            this.gs._io.emit('mobcreate', mob);\r\n        }\r\n    }\r\n\r\n    playerEnter(player) {\r\n        _.forEach(this.gs._mobs, (m)=> {\r\n            player.socket.emit('mobcreate', m);\r\n        });\r\n\r\n    }\r\n\r\n    hitMob(data) {\r\n\r\n        let to = _.find(this.gs._mobs, {_id: data.to});\r\n        let from = _.find(this.gs._players, {_id: data.sender});\r\n        if (to && from) {\r\n            let multiply = 1;\r\n            if (data.skill) {\r\n                multiply = data.skill;\r\n            }\r\n            let damage = parseInt(_.random(2, 7 * multiply));\r\n            to.health -= damage;\r\n            data.health = to.health;\r\n            if (to.health <= 0) {\r\n                to.health = 0;\r\n                data.health = 0;\r\n            }\r\n            this.gs._io.emit('mobhit', data);\r\n            if (to.health <= 0) {\r\n                this.gs._io.emit('mobkill', to);\r\n                _.remove(this.gs._mobs, {_id: to._id});\r\n            }\r\n            from.data.health -= Math.floor(1 + Math.random() * 3);\r\n\r\n            this.gs.plugins.Player.syncHealth(from);\r\n        }\r\n    }\r\n}\r\n\r\nMob.version = 0.1;\r\n\r\nmodule.exports.Mob = Mob;"]}