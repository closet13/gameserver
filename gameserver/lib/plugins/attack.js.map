{"version":3,"sources":["../../src/plugins/attack.js"],"names":[],"mappings":";;;;;;;;;;;;;;AAIA,IAAI,UAAU,QAAQ,YAAR,CAAV;AACJ,IAAI,SAAS,QAAQ,aAAR,EAAuB,MAAvB;AACb,IAAI,IAAI,QAAQ,QAAR,CAAJ;;IAEE;;;AACF,aADE,MACF,GAAc;8BADZ,QACY;;sEADZ,oBACY;KAAd;;iBADE;;gCAKM,IAAI;AACR,iBAAK,MAAL,CAAY,IAAZ,CAAiB,uBAAjB,EADQ;AAER,iBAAK,EAAL,GAAU,EAAV,CAFQ;AAGR,iBAAK,EAAL,CAAQ,OAAR,EAAiB,KAAK,GAAL,CAAS,IAAT,CAAc,IAAd,CAAjB,EAHQ;;;;4BAOR,MAAM,QAAQ;;;AAGd,gBAAI,KAAK,EAAE,IAAF,CAAO,KAAK,EAAL,CAAQ,QAAR,EAAkB,EAAC,KAAK,KAAK,EAAL,EAA/B,CAAL,CAHU;AAId,gBAAI,OAAO,EAAE,IAAF,CAAO,KAAK,EAAL,CAAQ,QAAR,EAAkB,EAAC,KAAK,KAAK,MAAL,EAA/B,CAAP,CAJU;AAKd,gBAAI,WAAW,CAAX,CALU;AAMd,gBAAI,KAAK,KAAL,EAAY;AACZ,2BAAW,KAAK,KAAL,CADC;aAAhB;;AAIA,gBAAI,MAAM,IAAN,EAAY;;AAEZ,mBAAG,IAAH,CAAQ,MAAR,IAAkB,KAAK,KAAL,CAAW,IAAI,KAAK,MAAL,KAAgB,EAAhB,GAAqB,QAArB,CAAjC,CAFY;;AAIZ,oBAAI,GAAG,IAAH,CAAQ,MAAR,GAAiB,CAAjB,EAAoB;AACpB,uBAAG,IAAH,CAAQ,MAAR,GAAiB,CAAjB;;AADoB,iBAAxB;;AAKA,qBAAK,EAAL,CAAQ,OAAR,CAAgB,MAAhB,CAAuB,UAAvB,CAAkC,EAAlC,EATY;aAAhB;;;;WAtBF;EAAe;;AAsCrB,OAAO,OAAP,GAAiB,GAAjB;;AAEA,OAAO,OAAP,CAAe,MAAf,GAAwB,MAAxB","file":"attack.js","sourcesContent":["/**\r\n * Created by santi8ago8 on 11/11/15.\r\n */\r\n\r\nlet request = require('superagent');\r\nvar Plugin = require('./../plugin').Plugin;\r\nlet _ = require('lodash');\r\n\r\nclass Attack extends Plugin {\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    enabled(gs) {\r\n        this.logger.info('Attack plugin enabled');\r\n        this.gs = gs;\r\n        this.on('s:hit', this.hit.bind(this));\r\n    }\r\n\r\n\r\n    hit(data, socket) {\r\n        //this.logger.info('hit', data);\r\n\r\n        let to = _.find(this.gs._players, {_id: data.to});\r\n        let from = _.find(this.gs._players, {_id: data.sender});\r\n        let multiply = 1;\r\n        if (data.skill) {\r\n            multiply = data.skill;\r\n        }\r\n\r\n        if (to && from) {\r\n\r\n            to.data.health -= Math.floor(1 + Math.random() * 10 * multiply);\r\n\r\n            if (to.data.health < 0) {\r\n                to.data.health = 0;\r\n                //TODO: dieeeee...\r\n            }\r\n\r\n            this.gs.plugins.Player.syncHealth(to);\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\nAttack.version = 0.1; \r\n\r\nmodule.exports.Attack = Attack;"]}